---
title: "Queries"
output: html_document
date: '2022-05-17'
---
Rapor için data summary yapılabilir (öğrencilerin yüzde kaçının annesi ölmüş gibi)
sunum yapılacak herkes orada olacak sunum paylaşılacak
rapor yazılacak. template paylaşılacak

Data excel dosyasından okundu

```{r}
library(readxl)
df <- read_excel("C:/Users/HAKKICAN/Desktop/Ders Projeleri/AML_PROJECT/01.AML_DATA_Etiketleri_Duzenlenmis.xls")
df

#Başarılı öğrencileri hesapla
df$ORTALAMA
ort <- mean(df$ORTALAMA)
ort
df <- transform(df, Başarılı.Mı= ifelse(ort >= ORTALAMA, 0, 1))
data.frame(df$ORTALAMA,df$Başarılı.Mı)
df
```

QUESTIONS:
1. Köyde yaşayanlar, şehir merkezinde yaşayanlara göre daha başarılı mıdır ?

2. Anne ve babanın ayrı olmasından kızlar / erkekler daha olumsuz etkilenmiştir.

3. Hangi kolon başarı için daha önemlidir?

4. Yeni bir öğrenci geçer not alabilir mi? (Biri geçer biri kalır 2 örnek yaparsak güzel olur)

5. En benzer ve en farklı öğrenciler (4 col)

6. Anne babanın eğitim durumu hangi sınıf seviyesinde daha etkilidir?

1. Köyde yaşayanlar, şehir merkezinde yaşayanlara göre daha başarılı mıdır ?

Answer 1

```{r}
install.packages("dplyr")
library(dplyr)
# Köyde (0) yaşayan başarılı öğrenci (1) sayısı
df$IKAMET
df$Başarılı.Mı
koyDf <- filter(df, IKAMET == 0)
basariliDf <- filter(df, Başarılı.Mı == 1)
koyIntersectDf <- intersect(koyDf, basariliDf)
# Kesişim df
data.frame(koyIntersectDf$IKAMET, koyIntersectDf$Başarılı.Mı)

koyBasariliSayisi <- nrow(koyIntersectDf)

# Merkezde (1) yaşayan başarılı öğrenci (1) sayısı
merkezDf <- filter(df, IKAMET == 1)
merkezIntersectDf <- intersect(merkezDf, basariliDf)
# Kesişim df
data.frame(merkezIntersectDf$IKAMET, merkezIntersectDf$Başarılı.Mı)

merkezBasariliSayisi <- nrow(merkezIntersectDf)
if (koyBasariliSayisi > merkezBasariliSayisi) {
  print("Köy başarılı")
} else {
  print("Merkez başarılı")
}
  
```

2. Anne ve babanın ayrı olmasından kızlar / erkekler daha olumsuz etkilenmiştir.

Answer 2

```{r}
df$`Anne ve babası ayrı mı?`

#Anne ve Baba ayrı mı (1) kız (0) ve başarısız (0) öğrenci sayısı
df$CİNSİYET
df$Başarılı.Mı
anneVeBabaAyriMiKızBasarisizDf <- filter(df, "Anne ve babası ayrı mı?" == 1 & CİNSİYET == 0 & Başarılı.Mı == 0)

anneVeBabaAyriMiKızBasarisizSayisi <- nrow(anneVeBabaAyriMiKızBasarisizDf)

#Anne ve Baba ayrı mı (1) erkek (1) ve başarısız (0) öğrenci sayısı
anneVeBabaAyriMiErkekBasarisizDf <- filter(df, "Anne ve babası ayrı mı?" == 1 & CİNSİYET == 1 & Başarılı.Mı == 0)

anneVeBabaAyriMiErkekBasarisizSayisi <- nrow(anneVeBabaAyriMiErkekBasarisizDf)

if (anneVeBabaAyriMiKızBasarisizSayisi > anneVeBabaAyriMiErkekBasarisizSayisi) {
  print("Anne ve Baba ayrımından en çok etkilenen öğrenciler kız öğrencilerdir.")
} else if (anneVeBabaAyriMiKızBasarisizSayisi < anneVeBabaAyriMiErkekBasarisizSayisi) {
  print("Anne ve Baba ayrımından en çok etkilenen öğrenciler erkek öğrencilerdir.")
} else {
  print("Anne ve Babanın ayrımından her iki cinsiyetde eşit etkileniyor.")
}
```

3. Hangi kolon başarı için daha önemlidir?

Answer 3

```{r}
#Column silmek için
df = df[,!(names(df) %in% c("Geçer.Mİ","Geçer.Mİ.1", "Geçer.Mİ.2"))]

#df den sadece soruları aldık
names(df)
dfSorular <- df[, !(names(df) %in% c("OKUL", "SINIF", "NO", "ADI.SOYADI", "CİNSİYET.1..Erkek.0..Kız", "İKAMET.1..Merkez.0..Köy", "ORTALAMA"))]

install.packages("FSelectorRcpp")
library("FSelectorRcpp")
informatinGain <- information_gain(formula(dfSorular), dfSorular, equal = FALSE)
maxGain <- max(informatinGain$importance)
maxGainIndex <- match(maxGain, informatinGain$importance)
informatinGain$attributes[maxGainIndex]
```

4. Yeni bir öğrenci geçer not alabilir mi? (Biri geçer biri kalır 2 örnek yaparsak güzel olur)

Answer 4

```{r}
#https://www.geeksforgeeks.org/naive-bayes-classifier-in-r-programming/
install.packages("e1071")
install.packages("caTools")
install.packages("caret")

library(e1071)
library(caTools)
library(caret)

# Splitting data into train
# and test data
split <- sample.split(dfSorular, SplitRatio = 0.7)
split
trainCl <- subset(dfSorular, split == "TRUE")
trainCl
testCl <- subset(dfSorular, split == "FALSE")
testCl

# Feature Scaling
trainScale <- scale(trainCl[, 1:4])
trainScale
testScale <- scale(testCl[, 1:4])
testScale

# Fitting Naive Bayes Model
# to training dataset
set.seed(120) #Setting Seed
classifierCl <- naiveBayes(formula(dfSorular), data = trainCl)
classifierCl

# Predicting on test data'
yPred <- predict(classifierCl, newdata = testCl)
yPred

# Confusion Matrix
cm <- table(testCl$Başarılı.Mı, yPred)
cm

# Model Evaluation
confusionMatrix(cm)
```
En başarılı öğrenci

```{r}
maxOrt <- max(df$ORTALAMA)
maxOrtIndex <- match(maxOrt, df$ORTALAMA)
df$`ADI SOYADI`[maxOrtIndex]
```

